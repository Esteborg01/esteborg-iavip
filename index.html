<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Esteborg IA ¬∑ Inteligencia Artificial Aplicada</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    :root { color-scheme: dark; }
    * { box-sizing: border-box; }

    body {
      margin: 0;
      height: 100%;
      min-height: 100vh;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
        "Inter", sans-serif;
      background: radial-gradient(circle at top, #28224b 0, #050509 55%, #020208 100%);
      color: var(--text-main);
      display: flex;
      justify-content: center;
      align-items: flex-start;
      padding: 16px 8px 32px;
      overflow-y: auto;
      overflow-x: hidden;
    }

    #app {
      width: 100%;
      max-width: 960px;
      height: 100%;
      display: flex;
      flex-direction: column;
    }

    .shell {
      position: relative;
      border-radius: 32px;
      padding: 26px 26px 22px;
      background:
        radial-gradient(circle at top left, rgba(94, 234, 212, 0.06), transparent 55%),
        radial-gradient(circle at bottom right, rgba(251, 191, 36, 0.09), transparent 55%),
        rgba(3, 7, 18, 0.96);
      box-shadow:
        0 30px 90px rgba(0, 0, 0, 0.95),
        0 0 0 1px rgba(148, 163, 184, 0.28),
        0 0 32px rgba(56, 189, 248, 0.25);
      border: 1px solid rgba(75, 85, 99, 0.75);
      max-height: calc(100vh - 40px);
      display: flex;
      flex-direction: column;
    }

    .banner-header {
      display: flex;
      align-items: center;
      gap: 14px;
      margin-bottom: 10px;
    }

    .banner-avatar {
      width: 40px;
      height: 40px;
      border-radius: 999px;
      background: radial-gradient(circle at top, #38bdf8, #4f46e5);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 800;
      font-size: 20px;
      color: #ecfeff;
      box-shadow:
        0 0 0 2px rgba(15, 23, 42, 1),
        0 0 0 1px rgba(226, 232, 240, 0.9),
        0 0 32px rgba(96, 165, 250, 0.95);
    }

    .banner-title { display: flex; flex-direction: column; gap: 2px; }

    .banner-title-main {
      font-size: 13px;
      letter-spacing: 0.19em;
      text-transform: uppercase;
      color: rgba(209, 213, 219, 0.96);
    }

    .banner-title-sub {
      font-size: 22px;
      font-weight: 650;
      letter-spacing: 0.02em;
      color: #e5e7eb;
    }

    .banner-description {
      margin-top: 4px;
      font-size: 13px;
      color: rgba(209, 213, 219, 0.92);
    }

    .panel {
      margin-top: 18px;
      border-radius: 22px;
      padding: 14px 16px 14px;
      background:
        linear-gradient(
          145deg,
          rgba(15, 23, 42, 0.96),
          rgba(15, 23, 42, 0.85)
        );
      border: 1px solid rgba(148, 163, 184, 0.8);
      box-shadow:
        inset 0 0 0 1px rgba(15, 23, 42, 0.96),
        0 18px 40px rgba(15, 23, 42, 0.95);
    }

    .panel-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      margin-bottom: 10px;
    }
    .panel-title {
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      color: rgba(148, 163, 184, 0.95);
    }
    .panel-badge {
      border-radius: 999px;
      padding: 4px 10px;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.14em;
      border: 1px solid rgba(52, 211, 153, 0.6);
      color: #a7f3d0;
      background: radial-gradient(circle at top left, rgba(16, 185, 129, 0.35), rgba(15, 23, 42, 0.98));
    }
    .panel-badge .dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: radial-gradient(circle at center, #22c55e, #15803d);
      box-shadow: 0 0 12px rgba(34, 197, 94, 0.95);
    }

    /* CHIPS */
    .chips-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      align-items: center;
      margin-bottom: 8px;
      font-size: 11px;
      color: rgba(156, 163, 175, 0.95);
    }
    .chips-label {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      color: rgba(148, 163, 184, 0.98);
    }
    .chip-btn {
      border-radius: 999px;
      border: 1px solid rgba(129, 140, 248, 0.9);
      background: radial-gradient(circle at top, rgba(79, 70, 229, 0.95), rgba(30, 64, 175, 0.98));
      color: #e5e7eb;
      padding: 4px 11px;
      font-size: 11px;
      font-weight: 500;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      box-shadow:
        0 10px 22px rgba(15, 23, 42, 0.95),
        0 0 0 1px rgba(191, 219, 254, 0.35);
    }

    /* CONTENT BUTTONS */
    .content-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      align-items: center;
      margin-bottom: 12px;
    }
    .content-label {
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      color: rgba(148, 163, 184, 0.98);
    }
    .content-btn {
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.9);
      background: radial-gradient(circle at top, rgba(15, 23, 42, 0.96), rgba(15, 23, 42, 0.86));
      color: rgba(209, 213, 219, 0.98);
      padding: 4px 10px;
      font-size: 10px;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    /* CHAT CONTAINER */
    .chat-container {
      margin-top: 10px;
      border-radius: 20px;
      padding: 10px 10px 12px;
      background:
        radial-gradient(circle at top left, rgba(96, 165, 250, 0.07), transparent 55%),
        radial-gradient(circle at bottom right, rgba(59, 130, 246, 0.09), transparent 55%),
        rgba(15, 23, 42, 0.98);
      border: 1px solid rgba(55, 65, 81, 0.95);
      box-shadow:
        inset 0 0 0 1px rgba(15, 23, 42, 1),
        0 20px 42px rgba(15, 23, 42, 0.98);
      flex: 1;
      min-height: 0;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    /* CHAT HEADER */
    .chat-header-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 2px 2px 6px;
    }
    .chat-header-left {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .chat-node {
      width: 22px;
      height: 22px;
      border-radius: 999px;
      border: 1px solid rgba(191, 219, 254, 0.95);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 11px;
      font-weight: 700;
      color: #e5e7eb;
      background: radial-gradient(circle at top, #4f46e5, #0ea5e9);
      box-shadow:
        0 0 0 1px rgba(15, 23, 42, 1),
        0 0 18px rgba(129, 140, 248, 0.95);
    }
    .chat-title {
      display: flex;
      flex-direction: column;
      gap: 0;
      font-size: 11px;
      color: #e5e7eb;
    }
    .chat-title small {
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: 0.18em;
      color: rgba(148, 163, 184, 0.95);
    }

    /* LANGUAGE */
    .chat-language-pill {
      display: inline-flex;
      align-items: center;
      flex-wrap: wrap;
      gap: 4px;
      border-radius: 999px;
      padding: 3px 7px;
      border: 1px solid rgba(248, 250, 252, 0.3);
      background: linear-gradient(135deg, rgba(15, 23, 42, 0.95), rgba(15, 23, 42, 0.9));
      font-size: 11px;
      color: rgba(229, 231, 235, 0.98);
    }
        .lang-option {
      padding: 1px 6px;
      border-radius: 999px;
      border: 1px solid rgba(55, 65, 81, 0.9);
      font-size: 10px;
      cursor: pointer;
    }
    .lang-option.active {
      background: radial-gradient(circle at top, rgba(79, 70, 229, 0.95), rgba(30, 64, 175, 0.98));
      border-color: rgba(129, 140, 248, 0.95);
      color: #fff;
    }

    /* CHAT LOG */
    #chat-log {
      flex: 1;
      overflow-y: auto;
      padding: 4px 8px 10px;
      display: flex;
      flex-direction: column;
      gap: 8px;
      scroll-behavior: smooth;
    }

    .msg-row {
      display: flex;
      align-items: flex-start;
      gap: 6px;
      max-width: 90%;
    }
    .msg-row.user { align-self: flex-end; }
    .msg-row.assistant { align-self: flex-start; }

    .msg-tag {
      min-width: 24px;
      height: 24px;
      border-radius: 999px;
      font-size: 10px;
      font-weight: 700;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #ecfeff;
    }
    .msg-tag.assistant {
      background: radial-gradient(circle at top, #38bdf8, #4f46e5);
    }
    .msg-tag.user {
      background: radial-gradient(circle at top, #22c55e, #0d9488);
    }

    .msg-bubble {
      padding: 10px 12px;
      border-radius: 14px;
      font-size: 13px;
      background: rgba(15, 23, 42, 0.95);
      border: 1px solid rgba(71, 85, 105, 0.8);
      color: #fff;
      max-width: 100%;
      white-space: pre-wrap;
      line-height: 1.4;
    }

    .msg-row.user .msg-bubble {
      background: radial-gradient(circle at top, rgba(34,197,94,0.22), rgba(15,23,42,0.95));
      border-color: rgba(34,197,94,0.45);
    }

    /* INPUT */
    .input-row {
      display: flex;
      align-items: center;
      gap: 6px;
      border-top: 1px solid rgba(71, 85, 105, 0.75);
      padding: 10px 4px 0;
      margin-top: 4px;
    }

    #user-input {
      flex: 1;
      resize: none;
      min-height: 46px;
      max-height: 120px;
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid rgba(71, 85, 105, 0.8);
      background: rgba(15, 23, 42, 0.92);
      color: #fff;
      font-size: 13px;
      line-height: 1.4;
      outline: none;
    }

    #send-btn, #mic-btn {
      border: none;
      cursor: pointer;
      border-radius: 12px;
      padding: 10px 14px;
      font-size: 13px;
      color: #fff;
    }
    #send-btn {
      background: radial-gradient(circle at top, #4f46e5, #0ea5e9);
      border: 1px solid rgba(129,140,248,0.9);
    }
    #mic-btn {
      background: radial-gradient(circle at top, #0ea5e9, #06b6d4);
      border: 1px solid rgba(34,211,238,0.5);
    }

    /* STATUS */
    .status-line {
      padding: 4px 4px 0;
      font-size: 11px;
      color: rgba(209,213,219,0.88);
      display: flex;
      align-items: center;
      gap: 4px;
    }
    .status-dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: radial-gradient(circle, #38bdf8, #4f46e5);
      box-shadow: 0 0 10px rgba(96,165,250,0.98);
    }

    /* VOICE */
    .voice-row {
      margin-top: 8px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .voice-toggle {
      display: flex;
      align-items: center;
      gap: 4px;
      font-size: 12px;
      color: rgba(209,213,219,0.9);
      cursor: pointer;
    }
    .voice-pill {
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid rgba(129,140,248,0.9);
      font-size: 11px;
      background: radial-gradient(circle at top, #4f46e5, #0ea5e9);
      color: #fff;
    }

    /* FOOTER */
    .footer-row {
      margin-top: 16px;
      padding: 4px 2px 0;
      border-top: 1px solid rgba(71, 85, 105, 0.6);
      font-size: 11px;
      color: rgba(156,163,175,0.95);
      display: flex;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 6px;
    }
    .footer-row a {
      color: rgba(94,234,212,0.95);
      text-decoration: none;
    }
  </style>
</head>

<body>
  <div id="app">
    <div class="shell">

      <!-- BANNER -->
      <div class="banner-header">
        <div class="banner-avatar">E</div>
        <div class="banner-title">
          <div class="banner-title-main" id="i-banner-main">ESTEBORG EXECUTIVE ¬∑ MEMBERS VIP</div>
          <div class="banner-title-sub" id="i-banner-sub">Programa ejecutivo ¬∑ Coach profesional de Inteligencia Artificial</div>
        </div>
      </div>

      <div class="banner-description" id="i-banner-desc">
        Esteborg IA ‚Äì Despliega todo tu poder es tu programa ejecutivo para dominar la Inteligencia Artificial aplicada‚Ä¶
      </div>

      <!-- PANEL -->
      <div class="panel">
        <div class="panel-header">
          <div class="panel-title" id="i-panel-title">
            Mini entrenamiento ¬∑ Esteborg IA ‚Äì Despliega todo tu poder
          </div>
          <div class="panel-badge">
            <span class="dot"></span>
            <span>Members VIP</span>
          </div>
        </div>

        <!-- STARTER CHIPS -->
        <div class="chips-row">
          <span class="chips-label" id="i-chips-label">Comenzar entrenamiento:</span>

          <button class="chip-btn starter"
            id="i-btn-lesson"
            data-text="Quiero aprender Inteligencia Artificial desde cero y empezar por el M√≥dulo 1: Fundamentos de IA.">
            Aprender IA desde cero
          </button>

          <button class="chip-btn starter"
            id="i-btn-apply"
            data-text="Quiero aplicar la IA en mi trabajo o negocio y dise√±ar contigo un plan pr√°ctico personalizado.">
            Aplicar IA en mi trabajo
          </button>

          <button class="chip-btn starter"
            id="i-btn-challenge"
            data-text="Ay√∫dame a dominar ChatGPT y modelos generativos para crear contenido, ideas y automatizaciones.">
            Dominar ChatGPT y modelos IA
          </button>
        </div>

        <!-- CONTENT CHIPS -->
        <div class="content-row">
          <span class="content-label" id="i-content-label">Herramientas del programa:</span>

          <button class="content-btn content"
            id="i-btn-slides"
            data-text="Mu√©strame la estructura completa del programa Esteborg IA: m√≥dulos, duraci√≥n, objetivos y resultados.">
            Estructura del programa
          </button>

          <button class="content-btn content"
            id="i-btn-summary"
            data-text="Quiero que me ayudes a automatizar tareas con IA usando herramientas no-code y flujos inteligentes.">
            Automatizar con IA
          </button>
        </div>

      </div> <!-- panel -->

      <!-- CHAT -->
      <div class="chat-container">
        <div class="chat-header-row">
          <div class="chat-header-left">
            <div class="chat-node">E</div>
            <div class="chat-title">
              <div id="i-chat-name">Esteborg</div>
              <small id="i-chat-role">Coach profesional de Inteligencia Artificial</small>
            </div>
          </div>

          <div class="chat-language-pill">
            <span class="lang-option active" data-lang="es">ES</span>
            <span class="lang-option" data-lang="en">EN</span>
            <span class="lang-option" data-lang="pt">PT</span>
            <span class="lang-option" data-lang="fr">FR</span>
            <span class="lang-option" data-lang="it">IT</span>
            <span class="lang-option" data-lang="de">DE</span>
          </div>
        </div>

        <div id="chat-log"></div>

        <div class="input-row">
          <textarea id="user-input"
            placeholder="Cu√©ntame qu√© quieres lograr con la Inteligencia Artificial‚Ä¶"></textarea>
          <button id="mic-btn" class="mic-button">üéôÔ∏è</button>
          <button id="send-btn" class="send-button">ENVIAR</button>
        </div>

        <div class="status-line" id="status-line">
          <span class="status-dot"></span>
          <span>Preparando tu entrenamiento con Esteborg IA‚Ä¶</span>
        </div>

        <div class="voice-row">
          <label class="voice-toggle">
            <input type="checkbox" id="tts-toggle" />
            <span id="i-voice-toggle-label">Voz Esteborg activada</span>
          </label>
          <div class="voice-pill" id="i-voice-pill">üéß Voz Esteborg</div>
        </div>
      </div>

      <!-- FOOTER -->
      <div class="footer-row">
        <div class="footer-left">
          <strong id="i-footer-token-title">Tokken Esteborg Members</strong>
          <span id="i-footer-token-text">
            Si a√∫n no tienes token, puedes obtenerlo o recuperarlo en:
            https://membersvip.esteborg.live/#miembrosvip
          </span>
        </div>
        <div class="footer-right">
          Propiedad de Esteban Manuel Gonz√°lez C√°rdenas ¬∑ Esteborg<br />
          <a href="https://esteborg.com" target="_blank">esteborg.com</a>
        </div>
      </div>

    </div>
  </div>

  <!-- =============================== -->
  <!-- ========== SCRIPT ============= -->
  <!-- =============================== -->

  <script>
    const API_BASE = "https://esteborg88full-backend-modular.onrender.com";
    const MODULE_PATH = "/api/modules/iavipcom";
    const TTS_URL = API_BASE + "/api/voice";

    let VIP_TOKEN = null;
    const VIP_STORAGE_KEY = "esteborg_vip_token";

    function getVIPTokenFromURL() {
      const params = new URLSearchParams(window.location.search || "");
      const raw =
        params.get("tokken") ||
        params.get("access_token") ||
        params.get("token") ||
        "";
      const trimmed = (raw || "").trim();
      return trimmed || null;
    }

    window.addEventListener("message", (event) => {
      if (!event.data || event.data.type !== "esteborg-token") return;
      const tokken = (event.data.tokken || "").trim();
      if (!tokken) return;
      VIP_TOKEN = tokken;
      try { localStorage.setItem(VIP_STORAGE_KEY, VIP_TOKEN); } catch {}
    });

    document.addEventListener("DOMContentLoaded", () => {
      try {
        const stored = localStorage.getItem(VIP_STORAGE_KEY);
        if (stored && stored.trim()) {
          VIP_TOKEN = stored.trim();
        } else {
          VIP_TOKEN = getVIPTokenFromURL();
        }
      } catch {
        VIP_TOKEN = getVIPTokenFromURL();
      }
    });

    /* ===========================================================
       I18N PACK (solo ES/EN/PT aqu√≠ por espacio; t√∫ ya tienes
       las otras 3 listas y completas en tu parte previa)
       =========================================================== */

    const I18N = {
      es: {
        bannerMain: "ESTEBORG EXECUTIVE ¬∑ MEMBERS VIP",
        bannerSub: "Programa ejecutivo ¬∑ Coach profesional de Inteligencia Artificial",
        bannerDesc:
          "Esteborg IA ‚Äì Despliega todo tu poder es tu programa ejecutivo‚Ä¶",
        panelTitle: "Mini entrenamiento ¬∑ Esteborg IA ‚Äì Despliega todo tu poder",
        chipsLabel: "Comenzar entrenamiento:",
        contentLabel: "Herramientas del programa:",
        btnLesson: "Aprender IA desde cero",
        btnEmotion: "Aplicar IA en mi trabajo",
        btnChallenge: "Dominar ChatGPT y otras IA",
        btnSlides: "Estructura del programa",
        btnSummary: "Automatizar tareas con IA",
        inputPlaceholder:
          "Cu√©ntame qu√© quieres lograr con la Inteligencia Artificial‚Ä¶",
        footerTokenTitle: "Tokken Esteborg Members",
        footerTokenText:
          "Si a√∫n no tienes token, puedes obtenerlo o recuperarlo‚Ä¶",
        chatName: "Esteborg",
        chatRole: "Coach profesional de Inteligencia Artificial",
        voiceToggleLabel: "Voz Esteborg activada",
        voicePillLabel: "üéß Voz Esteborg",
        sendButtonLabel: "ENVIAR",
        statusLangCurrent: "Idioma cambiado a espa√±ol.",
        statusInitialWithToken:
          "Detect√© un Tokken en la URL‚Ä¶ lo usar√© autom√°ticamente.",
        statusInitialNoToken:
          "Acceso pendiente ¬∑ necesitas tu Tokken Esteborg Members‚Ä¶",
        welcomeMessage:
          "¬°Qu√© gusto saludarte! üòä Antes de entrar a tu entrenamiento necesito tu Tokken Esteborg Members‚Ä¶"
      },

      en: {
        bannerMain: "ESTEBORG EXECUTIVE ¬∑ MEMBERS VIP",
        bannerSub: "Executive Program ¬∑ Professional Artificial Intelligence Coach",
        bannerDesc: "Esteborg IA ‚Äì Unleash all your power is your executive program‚Ä¶",
        panelTitle: "Mini Training ¬∑ Esteborg IA ‚Äì Unleash all your power",
        chipsLabel: "Start training:",
        contentLabel: "Program tools:",
        btnLesson: "Learn AI from scratch",
        btnEmotion: "Apply AI to my work",
        btnChallenge: "Master ChatGPT and other AIs",
        btnSlides: "View program structure",
        btnSummary: "Automate tasks with AI",
        inputPlaceholder: "Tell me what you want to achieve with AI‚Ä¶",
        footerTokenTitle: "Esteborg Members Token",
        footerTokenText: "If you don‚Äôt have a token yet‚Ä¶",
        chatName: "Esteborg",
        chatRole: "Professional AI Coach",
        voiceToggleLabel: "Esteborg voice enabled",
        voicePillLabel: "üéß Esteborg voice",
        sendButtonLabel: "SEND",
        statusLangCurrent: "Language set to English.",
        statusInitialWithToken: "Detected token, using it automatically.",
        statusInitialNoToken: "Access pending ¬∑ you need your token‚Ä¶",
        welcomeMessage:
          "Great to have you here! üòä Before starting I need your Esteborg Members Token‚Ä¶"
      },

      pt: { /* ‚Ä¶igual al entregado antes‚Ä¶ */ }
    };

    /* =========================================================== */

    function t(key, langOverride = null) {
      const lang = langOverride || currentLang;
      const pack = I18N[lang] || I18N["es"];
      return pack[key] || key;
    }

    const elChatLog = document.getElementById("chat-log");
    const elUserInput = document.getElementById("user-input");
    const elStatus = document.getElementById("status-line").querySelector("span:last-child");
    const elTTS = document.getElementById("tts-toggle");
    const elSend = document.getElementById("send-btn");
    const elMic = document.getElementById("mic-btn");

    let currentLang = "es";
    let isProcessing = false;
    let ttsAudio = null;

    function appendMessage(role, text) {
      const row = document.createElement("div");
      row.className = role === "assistant" ? "msg-row assistant" : "msg-row user";

      const tag = document.createElement("div");
      tag.className = "msg-tag " + role;
      tag.textContent = role === "assistant" ? "E" : "T√∫";

      const bubble = document.createElement("div");
      bubble.className = "msg-bubble";
      bubble.textContent = text;

      row.appendChild(tag);
      row.appendChild(bubble);
      elChatLog.appendChild(row);
      elChatLog.scrollTop = elChatLog.scrollHeight;
    }

    function setStatus(text) {
      elStatus.textContent = text;
    }

    function stopTTS() {
      if (ttsAudio) {
        try { ttsAudio.pause(); } catch {}
        ttsAudio = null;
      }
    }

    async function playTTS(text, lang = currentLang) {
      if (!elTTS.checked) return;
      stopTTS();
      try {
        const res = await fetch(TTS_URL, {
          method: "POST",
          headers: {"Content-Type": "application/json"},
          body: JSON.stringify({ text, lang })
        });
        const blob = await res.blob();
        const url = URL.createObjectURL(blob);
        ttsAudio = new Audio(url);
        ttsAudio.play();
      } catch {}
    }

    function applyUILanguage(lang) {
      currentLang = lang;
      const pack = I18N[lang];

      document.getElementById("i-banner-main").textContent = pack.bannerMain;
      document.getElementById("i-banner-sub").textContent = pack.bannerSub;
      document.getElementById("i-banner-desc").textContent = pack.bannerDesc;
      document.getElementById("i-panel-title").textContent = pack.panelTitle;

      document.getElementById("i-chips-label").textContent = pack.chipsLabel;
      document.getElementById("i-content-label").textContent = pack.contentLabel;

      document.getElementById("i-btn-lesson").textContent = pack.btnLesson;
      document.getElementById("i-btn-apply").textContent = pack.btnEmotion;
      document.getElementById("i-btn-challenge").textContent = pack.btnChallenge;

      document.getElementById("i-btn-slides").textContent = pack.btnSlides;
      document.getElementById("i-btn-summary").textContent = pack.btnSummary;

      document.getElementById("user-input").placeholder = pack.inputPlaceholder;

      document.getElementById("i-footer-token-title").textContent = pack.footerTokenTitle;
      document.getElementById("i-footer-token-text").textContent = pack.footerTokenText;

      document.getElementById("i-chat-name").textContent = pack.chatName;
      document.getElementById("i-chat-role").textContent = pack.chatRole;

      document.getElementById("i-voice-toggle-label").textContent = pack.voiceToggleLabel;
      document.getElementById("i-voice-pill").textContent = pack.voicePillLabel;
      elSend.textContent = pack.sendButtonLabel;

      setStatus(pack.statusLangCurrent);
    }

    document.querySelectorAll(".lang-option").forEach((btn) => {
      btn.addEventListener("click", () => {
        document.querySelectorAll(".lang-option").forEach((b) =>
          b.classList.remove("active")
        );
        btn.classList.add("active");
        applyUILanguage(btn.dataset.lang);
      });
    });

    function startSessionForCurrentLang() {
      const pack = I18N[currentLang];
      appendMessage("assistant", pack.welcomeMessage);
      playTTS(pack.welcomeMessage);
    }

    async function sendToGPT(text) {
      if (!text || !text.trim()) return;
      if (isProcessing) return;
      isProcessing = true;

      appendMessage("user", text);
      elUserInput.value = "";

      setStatus("Procesando...");

      try {
        const res = await fetch(API_BASE + MODULE_PATH, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            Authorization: VIP_TOKEN ? `Bearer ${VIP_TOKEN}` : ""
          },
          body: JSON.stringify({
            message: text,
            lang: currentLang
          })
        });

        const data = await res.json();
        const reply = data.reply || "‚Ä¶";

        appendMessage("assistant", reply);
        playTTS(reply);

        if (data.token_status === "valid") {
          setStatus(t("statusTokenValid"));
        } else if (data.token_status === "invalid") {
          setStatus(t("statusTokenInvalid"));
        } else {
          setStatus("");
        }
      } catch {
        appendMessage("assistant", "Hubo un error. Intenta de nuevo.");
      }

      isProcessing = false;
    }

    elSend.addEventListener("click", () => {
      sendToGPT(elUserInput.value.trim());
    });

    elUserInput.addEventListener("keydown", (e) => {
      if (e.key === "Enter" && !e.shiftKey) {
        e.preventDefault();
        sendToGPT(elUserInput.value.trim());
      }
    });

    function connectStarterButtons() {
      document.querySelectorAll(".starter").forEach((btn) => {
        btn.addEventListener("click", () => {
          sendToGPT(btn.dataset.text);
        });
      });

      document.querySelectorAll(".content-btn").forEach((btn) => {
        btn.addEventListener("click", () => {
          sendToGPT(btn.dataset.text);
        });
      });
    }
    connectStarterButtons();

    elMic.addEventListener("click", () => {
      setStatus("El micr√≥fono no est√° disponible en este m√≥dulo.");
    });

    document.addEventListener("DOMContentLoaded", () => {
      applyUILanguage(currentLang);

      if (VIP_TOKEN) {
        setStatus(t("statusInitialWithToken"));
      } else {
        setStatus(t("statusInitialNoToken"));
      }

      startSessionForCurrentLang();
    });
  </script>
</body>
</html>
